<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Words</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #words {
            width: 100%;
            resize: vertical;
            min-height: 200px;
        }

        h6 {
            font-size: 0.9rem;
            font-weight: 600;
        }
    </style>
    <script>
      document.getElementById('words').value = new URL(window.location.href).searchParams.get("from");

      function updateToLanguages() {
        const fromRadio = document.querySelector('input[name="from"]:checked');
        const toCheckboxes = document.querySelectorAll('input[name="to"]');

        // disable the target also defined in the input
        toCheckboxes.forEach(checkbox => {
          if (fromRadio && checkbox.value === fromRadio.value) {
            checkbox.disabled = true;
            // checkbox.checked = false;
          } else {
            checkbox.disabled = false;
          }
        });
      }

      function openWindow(toValue, fromValue, word) {
        const sanitizedTarget = `win-${word}-${fromValue}-${toValue}`.replace(/\W+/g, "-");
        console.log(`opening ${toValue}`);
        if (toValue === 'definition') {
          // Handle definition checkbox
          const definitionUrls = {
            'it': 'definizione',
            'es': 'definicion',
            'en': 'definition',
          };
          window.open(`https://www.wordreference.com/${definitionUrls[fromValue]}/${word}`, `${sanitizedTarget}-definition`);
          return;
        }

        if (toValue === 'verb') {
          window.open(`https://www.wordreference.com/conj/${fromValue}verbs.aspx?v=${word}`, `${sanitizedTarget}-verb`);
          return;
        }

        // languages
        if (word.includes(' ')) {
          window.open(`https://translate.google.com/?hl=en&sl=${fromValue}&tl=${toValue}&text=${word}&op=translate`, `${sanitizedTarget}-translate`);
        }

        window.open(`https://www.wordreference.com/${fromValue}${toValue}/${word}`, `${sanitizedTarget}-wordreference`);
      }

      function words() {
        const fromRadio = document.querySelector('input[name="from"]:checked');
        if (!fromRadio) {
          alert("Please select a 'from' language");
          return;
        }

        // checks
        const toLanguageCheckboxes = document.querySelectorAll('input[name="to"]:checked:not(:disabled)');
        if (toLanguageCheckboxes.length === 0) {
          alert("Please select at least one target");
          return;
        }

        const fromValue = fromRadio.value;
        const wordsArray = document.getElementById("words").value
          .replaceAll(/\n+/g, "\n")
          .split("\n")
          .map(s => s.trim())
          .filter(s => s.length > 2);

        wordsArray.forEach(word => {
          toLanguageCheckboxes.forEach(toLanguage => {
            const toValue = toLanguage.value; // es, fr, it, definition, verb
            openWindow(toValue, fromValue, word);
          });
        });
      }

      function clearWordsOnly() {
        document.getElementById("words").value = "";
      }
    </script>
</head>
<body>
<div class="container-fluid p-3">
    <div class="row  mb-3">
        <div class="col-12 col-lg-4 ">
            <div class="border rounded p-2 bg-light">
                <h6 class="mb-2">From</h6>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="from" id="from-it" value="it"
                           onchange="updateToLanguages()">
                    <label class="form-check-label" for="from-it">Italian</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="from" id="from-en" value="en"
                           onchange="updateToLanguages()">
                    <label class="form-check-label" for="from-en">English</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="from" id="from-es" value="es"
                           onchange="updateToLanguages()">
                    <label class="form-check-label" for="from-es">Spanish</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="from" id="from-fr" value="fr"
                           onchange="updateToLanguages()">
                    <label class="form-check-label" for="from-fr">French</label>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-4 ">
            <label for="words" class="form-label small">Words one per line</label>
            <textarea class="form-control" id="words" rows="6"></textarea>
            <button class="btn btn-link w-100" onclick="clearWordsOnly()" type="button">Clear</button>
        </div>
        <div class="col-12 col-lg-4 ">
            <div class="border rounded p-2 bg-light mb-2">
                <h6 class="mb-2">To (select multiple)</h6>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="to" id="to-it" value="it">
                    <label class="form-check-label" for="to-it">Italian</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="to" id="to-en" value="en">
                    <label class="form-check-label" for="to-en">English</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="to" id="to-es" value="es">
                    <label class="form-check-label" for="to-es">Spanish</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="to" id="to-fr" value="fr">
                    <label class="form-check-label" for="to-fr">French</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="to" id="to-definition" value="definition">
                    <label class="form-check-label" for="to-definition">Definition</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="to" id="to-verb" value="verb">
                    <label class="form-check-label" for="to-verb">Verb conjugation</label>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-2 mb-5">
        <div class="col-4">
            <button type="button" class="btn btn-primary w-100" onclick="words()">Open All</button>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <a href="https://ankiuser.net/add" target="_blank" class="text-decoration-none">https://ankiuser.net/add</a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
